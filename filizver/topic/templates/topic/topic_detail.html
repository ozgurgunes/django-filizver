{% extends "filizver/filizver_base.html" %}
{% load tagging_tags %}

{% block title %}{{ object.title }} - {{ block.super }}{% endblock title %}
{% block main %}
    <!--// Headline -->
    <section id="breadcrumb" class="breadcrumb">
        <a href="{% url filizver:homepage %}">{% trans "Home" %}</a> <span class="divider">/</span>
        <a href="{% url accounts_profile_detail object.user %}">{{ object.user }}</a> <span class="divider">/</span>
        {{ object|truncatewords:"5" }}
    </section>

    <!--// Main -->
    <article id="main" role="main">
        <header class="page-header">
            <h1>{{ object.title }}</h1>
            <menu id="entry_{{ entry.id }}_commands" class="entry btn-group" align="right">
                <a class="btn" href="{% url filizver:topic_update object.id %}" title="{% trans "Update" %}"><span class="icon-edit"></span></a>
                <a class="btn" href="{% url filizver:topic_delete object.id %}" title="{% trans "Delete" %}"><span class="icon-remove"></span></a>
            </menu>
        </header>

        
    <!--// Entries -->
        {% if perms.topic.can_change or object.user == user %}
        {% include "topic/_entry_form.html" %}
        {% endif %}
        <script type="text/javascript"> 
        // When the document is ready set up our sortable with it's inherant function(s) 
        $(document).ready(function() { 
            $("#entries").sortable({
                handle:  '.handle',
                axis: 'y',
                placeholder: 'sortable-placeholder',
                forcePlaceholderSize: true,
                //tolerance: 'pointer',
                update : function () { 
                    //$("#leaves").load("process-sortable.php?"+order);
                    $.ajax({
                        url: '{% url filizver:entry_sort object.id %}', 
                        type: 'POST',
                        data: $('#entries').sortable('serialize'),
                        success: function(feedback){
                            $('#entries').html(feedback);
                        },
                    });
                }
            }); 
        }); 
        </script>     
        <section id="entries" class="main">
            {% include "topic/_topic_entries.html" %}
        </section>
    <!--// Details -->    
        {% if object.tag_list %}
        <details id="tags" class="main">
            <summary>{% trans 'Tags' %}:</summary>
            {% for tag in object.tag_list %}<a class="tag" href="{% url filizver.views.topic_tagged tag.name|urlencode %}">{{tag}}</a> &nbsp; {% endfor %}
        </details>
        {% endif %}

        <aside id="comments" class="main">
            {% include 'comments/comments_block.html' %}
        </aside>
        
    </article>
{% endblock %}
