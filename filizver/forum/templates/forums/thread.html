{% extends 'forums/base.html' %}
{% load i18n forum_tags pagination_tags %}


{% block title %}{{ block.super }} / {{ thread.forum.topic.title }} / {{ thread.topic.title }}{% endblock %}
{% block content %}
{% autopaginate replies defaults.TOPIC_PAGE_SIZE %}
{% paginate %}
<div class="linkst">
	<div class="inbox">
		<ul class="breadcrumb">
			<li><a href="{% url forum:index %}">{% trans "Forum" %}</a> <span class="divider">/</span></li>
			<li>{% link thread.forum %}  <span class="divider">/</span></li>
			<li>{{ thread.topic.title }}</li>
			<li><a href="{% url forum:forum_thread_feed thread.id %}"><img src="{{ STATIC_URL }}img/feed-icon-small.png" alt="[RSS Feed]" title="[RSS Feed]" class="breadcrumb_rss" /></a></li>
		</ul>
		<div class="clearer"></div>
	</div>
</div>
<h1 class="page-header">{{ thread.topic.title }}</h1>
{% for reply in replies %}
<a name="reply-{{ reply.id }}"></a>
	<div id="p{{ reply.id }}" class="row blockreply roweven firstreply">
			<div class="span3 replyleft">
					<dl>
						<dt><strong class="username">{{ reply.user.username }}</strong></dt>
						<dd class="usertitle">
							{% if reply.user.profile.status %}
								<strong>{{ reply.user.profile.status }}</strong>
							{% else %}
								<strong>{{ reply.user.profile.group }}</strong>
							{% endif %}
						</dd>
						{% if defaults.AUTHORITY_SUPPORT %}
							<dd class="usertitle">
								{{ reply.user|forum_authority }}
							</dd>
						{% endif %}
						<dd class="replyavatar">
							{% if reply.user.profile.avatar and reply.user.profile.show_avatar %}
								<img src="{{ reply.user.profile.avatar.url }}" />
							{% else %}
								{% if defaults.GRAVATAR_SUPPORT %}
									<img src="{% gravatar reply.user.email %}" />
								{% endif %}
							{% endif %}
						</dd>
						{% if reply.user.profile.location %}
							<dd>{% trans "From:" %} {{ reply.user.profile.location }}</dd>
						{% endif %}
						<dd>{% trans "Registered:" %} {{ reply.user.date_joined|date:"Y-m-d" }}</dd>
						<dd>{% trans "Replies:" %} {{ reply.user.profile.reply_count }}</dd>
						<dd class="usercontacts"><a href="{% url filizver:profile_detail reply.user.username %}">{% trans "Profile" %}</a>&nbsp;&nbsp;
						{% if reply.user.profile.privacy_permission == 0 %}
							<a href="mailto:{{ reply.user.email }}">{% trans "E-mail" %}</a>&nbsp;&nbsp;
						{% else %}
							{% if reply.user.profile.privacy_permission == 1 %}
								<a href="{% url forum:misc %}?mail_to={{ reply.user.username }}">{% trans "Send e-mail" %}</a>&nbsp;&nbsp;
							{% endif %}
						{% endif %}
						{% if defaults.PM_SUPPORT %}
							{% if user.is_authenticated %}
								<a href="{% url messages_compose_to reply.user.username %}">{% trans "PM" %}</a>&nbsp;&nbsp;</dd>
							{% endif %}
						{% endif %}
				</dl>
			</div>	
			<div class="span9 replyright">
        		<p><span>#{{ forloop.counter }}</span><a href="{{ reply.get_absolute_url }}">{% forum_time reply.created_date %}</a></p>
				<div class="replymsg">
					<p class="reply_body_html">{{ reply.body|safe|linebreaks }}</p>
					{% if not user.is_authenticated or user.profile.show_signatures %}
						{% if reply.user.profile.signature_html %}
						<div class="repliesignature">
							<br /><br/ >
							{{ reply.user.profile.signature_html|safe }}
						</div>
						{% endif %}
					{% endif %}
					{% if reply.updated_date %}
						<p class="replyedit"><em>{% trans "Edited" %} {{ reply.updated_date_by.username }} ({% forum_time reply.updated_date %})</em></p>
					{% endif %}
					{% with reply.attachments.all as attachments %}
						{% if attachments %}
							{% for attach in attachments %}
								<p class="replyedit"><em>{% trans "Attachments:" %} <br />{{ attach|attachment_link }}</em></p>
							{% endfor %}
						{% endif %}
					{% endwith %}
				</div>
			</div>
    </div>
    <div class="row">
			<div class="span3 replyfootleft">
				{% if reply.user|online %}
					<p><strong>{% trans "Online" %}</strong></p>
				{% else %}
					<p>{% trans "Offline" %}</p>
				{% endif %}
			</div>
			<div class="span9 replyfootright">
				<div class="btn-group">
					<a class="btn btn-small" href="{% url forum:misc %}?action=report&amp;reply_id={{ reply.id }}">{% trans "Report" %}</a>
					{% if moderator or reply|forum_equal_to:last_reply %}
						{% if moderator or reply.user|forum_equal_to:user %}
							<a class="btn btn-small" onclick="return confirm('{% trans "Are you sure you want to delete this reply?" %}')" href="{% url forum:delete_reply reply.id %}">{% trans "Delete" %}</a>
						{% endif %}
					{% endif %}
					{% if moderator or reply|forum_replied_by:user %}
						<a class="btn btn-small" href="{% url forum:edit_reply reply.id %}">{% trans "Edit" %}</a>
					{% endif %}
					{% if user.is_authenticated %}
						<a class="btn btn-small" onclick="return copy_paste('p{{ reply.id }}');" href="#reply" title="{% trans "Full quote or quote selected text form this reply." %}">{% trans "Quote" %}</a>
					{% endif %}
				</div>
			</div>
		</div>
{% endfor %}
<div class="replylinksb">
	<div class="inbox">
		<div class="pagelink conl">{% paginate %}</div>
		<ul class="breadcrumb">
			<li><a href="{% url forum:index %}">{% trans "Forum" %}</a> <span class="divider">/</span></li>
			<li>{% link thread.forum %}  <span class="divider">/</span></li>
			<li>{{ thread.topic.title }}</li>
			<li><a href="{% url forum:forum_thread_feed thread.id %}"><img src="{{ STATIC_URL }}img/feed-icon-small.png" alt="[RSS Feed]" title="[RSS Feed]" class="breadcrumb_rss" /></a></li>
		</ul>
		{% if user.is_authenticated %}
			{% if subscribed %}
				<a class="subscribelink clearb" href="{% url forum:forum_delete_subscription thread.id %}?from_thread">{% trans "Unsubscribe" %}</a>
			{% else %}
				<a class="subscribelink clearb" href="{% url forum:forum_add_subscription thread.id %}">{% trans "Subscribe" %}</a>
			{% endif %}
		{% endif %}
		<div class="clearer"></div>
	</div>
</div>

{% if reply_form %}
    {% with form=reply_form %}
        {% include "forums/reply_form.html" %}
    {% endwith %}
{% endif %}

{% endblock content%}

{% block controls %}
<div class="conl">
	<form id="qjump" method="get" action="forum">
		<div><label>{% trans "Jump to " %}
		<br />
		<select name="id" id="forum_id" onchange="window.location=('{% url forum:index %}'+this.options[this.selectedIndex].value)">
			{% for category in categories %}
				<optgroup label="{{ category }}">
					{% for forum in category.forums.all %}
						<option value="{{ forum.id }}">{{ forum }}</option>
					{% endfor %}
				</optgroup>
			{% endfor %}
		</select>
		<input type="button" onclick="window.location=('{% url forum:index %}'+getElementById('forum_id').value)" value=" {% trans "Go" %} " accesskey="g" />
		</label></div>
	</form>
	<dl id="modcontrols"><dt><strong>{% trans "Moderator control" %}</strong></dt>
	{% if moderator %}
		<dd><a href="{% url forum:delete_replies thread.id %}">{% trans "Delete multiple replies" %}</a></dd>
		<dd><a href="{% url forum:move_thread %}?thread_id={{ thread.id }}">{% trans "Move thread" %}</a></dd>
		{% if thread.closed %}
			<dd><a href="{% url forum:open_close_thread thread.id 'o' %}">{% trans "Open thread" %}</a></dd>
		{% else %}
			<dd><a href="{% url forum:open_close_thread thread.id 'c' %}">{% trans "Close thread" %}</a></dd>
		{% endif %}
		{% if thread.sticky %}
			<dd><a href="{% url forum:stick_unstick_thread thread.id 'u' %}">{% trans "Unstick thread" %}</a></dd></dl>
		{% else %}
			<dd><a href="{% url forum:stick_unstick_thread thread.id 's' %}">{% trans "Stick thread" %}</a></dd></dl>
		{% endif %}
	{% endif %}
    </dl>
</div>
{% endblock %}

{% block lofi %}
{% if defaults.LOFI_SUPPORT %}
    <p class="lofi">
        <a href="{{ thread.get_absolute_url }}lofi/">Lo-Fi Version</a>
    </p>
{% endif %}
{% endblock %}
